# Pytest æ•™ç¨‹ - 02. ç¼–å†™ä¸æ–­è¨€

> **é€‚åˆäººç¾¤**ï¼šPython å¼€å‘è€…
> **å‰ç½®çŸ¥è¯†**ï¼šPytest å®‰è£…
> **é¢„è®¡æ—¶é—´**ï¼š15 åˆ†é’Ÿ

## ğŸ” å¼ºå¤§çš„ Assert

ä¸ `unittest` ä¸åŒï¼ŒPytest ä¸éœ€è¦ `self.assertEqual`ã€‚ä½ åªéœ€è¦ä½¿ç”¨ Python åŸç”Ÿçš„ `assert` å…³é”®å­—ã€‚

Pytest ä½¿ç”¨ **Assertion Rewriting** æŠ€æœ¯ï¼Œèƒ½å¤Ÿé€šè¿‡å†…çœï¼ˆIntrospectionï¼‰æä¾›æå…¶è¯¦ç»†çš„å¤±è´¥ä¿¡æ¯ã€‚

### æ–­è¨€å†…çœæœºåˆ¶

```mermaid
graph TD
    Code[æºç : assert a == b] --> Rewrite[Pytest é‡å†™ AST]
    Rewrite --> Run[æ‰§è¡Œæµ‹è¯•]
    Run -- å¤±è´¥ --> Introspect[å†…çœå˜é‡å€¼]
    Introspect --> Report[ç”Ÿæˆè¯¦ç»† Diff]
```

## ğŸ“ å¸¸è§æ–­è¨€æ¨¡å¼

```python
def test_assertions():
    # ç›¸ç­‰
    assert 1 + 1 == 2
    
    # åŒ…å«
    assert 1 in [1, 2, 3]
    
    # å­—ç¬¦ä¸²åŒ…å«
    assert "test" in "this is a test"
    
    # æ¯”è¾ƒ
    assert 5 > 3
```

## ğŸ’¥ æµ‹è¯•å¼‚å¸¸

æœ‰äº›æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦æµ‹è¯•ä»£ç **æ˜¯å¦æŠ›å‡ºäº†é¢„æœŸçš„å¼‚å¸¸**ã€‚ä½¿ç”¨ `pytest.raises` ä¸Šä¸‹æ–‡ç®¡ç†å™¨ï¼š

```python
import pytest

def test_recursion_depth():
    with pytest.raises(ZeroDivisionError):
        1 / 0

def test_exception_message():
    # è¿˜å¯ä»¥åŒ¹é…å¼‚å¸¸ä¿¡æ¯
    with pytest.raises(ValueError, match="must be 0 or None"):
        raise ValueError("value must be 0 or None")
```

å¦‚æœä»£ç å—**æ²¡æœ‰**æŠ›å‡ºæŒ‡å®šçš„å¼‚å¸¸ï¼Œæµ‹è¯•å°†å¤±è´¥ã€‚

## ğŸ“š æ€»ç»“

*   ç›´æ¥ä½¿ç”¨ `assert`ï¼Œç®€å•ä¸”å¼ºå¤§ã€‚
*   ä½¿ç”¨ `pytest.raises` æµ‹è¯•å¼‚å¸¸æƒ…å†µã€‚
*   Pytest ä¼šè‡ªåŠ¨å±•ç¤ºåˆ—è¡¨ã€å­—å…¸ç­‰å¤æ‚ç»“æ„çš„è¯¦ç»† Diffã€‚

ä¸‹ä¸€ç« ï¼Œæˆ‘ä»¬å°†å­¦ä¹  Pytest çš„æ ¸å¿ƒåŠŸèƒ½ï¼š**Fixture**ã€‚
