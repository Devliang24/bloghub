# Pytest æ•™ç¨‹ - 03. Fixtureå›ºä»¶

> **é€‚åˆäººç¾¤**ï¼šè¿›é˜¶å¼€å‘è€…
> **å‰ç½®çŸ¥è¯†**ï¼šä¾èµ–æ³¨å…¥æ¦‚å¿µ
> **é¢„è®¡æ—¶é—´**ï¼š20 åˆ†é’Ÿ

## ğŸ§© ä»€ä¹ˆæ˜¯ Fixtureï¼Ÿ

**Fixture** æ˜¯ Pytest æœ€å¼ºå¤§çš„åŠŸèƒ½ä¹‹ä¸€ã€‚å®ƒç”¨äºæä¾›æµ‹è¯•æ‰€éœ€çš„åŸºå‡†ç¯å¢ƒï¼ˆå¦‚æ•°æ®åº“è¿æ¥ã€æµ‹è¯•æ•°æ®ã€ä¸´æ—¶æ–‡ä»¶ï¼‰ã€‚

è¿™æ˜¯ä¸€ç§**ä¾èµ–æ³¨å…¥**æœºåˆ¶ï¼šæµ‹è¯•å‡½æ•°å£°æ˜å®ƒéœ€è¦ä»€ä¹ˆï¼ŒPytest å°±è‡ªåŠ¨åˆ›å»ºå¹¶æ³¨å…¥ã€‚

### Fixture è°ƒç”¨æµç¨‹

```mermaid
graph LR
    Req[æµ‹è¯•å‡½æ•°è¯·æ±‚] --> Pytest
    Pytest -- æŸ¥æ‰¾ --> FixtureDef[@pytest.fixture]
    FixtureDef -- å®ä¾‹åŒ–/æ‰§è¡Œ --> Instance[å®ä¾‹å¯¹è±¡]
    Instance -- æ³¨å…¥ --> TestFunc[æ‰§è¡Œæµ‹è¯•]
    TestFunc -- ç»“æŸ --> Teardown[æ¸…ç†èµ„æº]
```

## ğŸ› ï¸ å®šä¹‰ä¸ä½¿ç”¨

```python
import pytest

# å®šä¹‰ Fixture
@pytest.fixture
def sample_data():
    return {"a": 1, "b": 2}

# ä½¿ç”¨ Fixture (ä½œä¸ºå‚æ•°ä¼ å…¥)
def test_data(sample_data):
    assert sample_data["a"] == 1
```

## ğŸ”„ Setup å’Œ Teardown

ä½¿ç”¨ `yield` å…³é”®å­—å¯ä»¥è½»æ¾å®ç° Setupï¼ˆå‡†å¤‡ï¼‰å’Œ Teardownï¼ˆæ¸…ç†ï¼‰ã€‚

```python
@pytest.fixture
def db_connection():
    print("\nè¿æ¥æ•°æ®åº“...")
    db = "Connection Object"
    
    yield db  # æµ‹è¯•å‡½æ•°åœ¨è¿™é‡Œæ‰§è¡Œ
    
    print("\nå…³é—­è¿æ¥...")
```

## ğŸŒ ä½œç”¨åŸŸ (Scope)

é»˜è®¤æƒ…å†µä¸‹ï¼ŒFixture åœ¨æ¯ä¸ªæµ‹è¯•å‡½æ•°æ‰§è¡Œæ—¶éƒ½ä¼šé‡æ–°åˆ›å»ºã€‚ä½ å¯ä»¥é€šè¿‡ `scope` å‚æ•°ä¿®æ”¹å…¶ç”Ÿå‘½å‘¨æœŸï¼š

*   `function` (é»˜è®¤)ï¼šæ¯ä¸ªå‡½æ•°ä¸€æ¬¡ã€‚
*   `class`ï¼šæ¯ä¸ªç±»ä¸€æ¬¡ã€‚
*   `module`ï¼šæ¯ä¸ªæ¨¡å—ï¼ˆæ–‡ä»¶ï¼‰ä¸€æ¬¡ã€‚
*   `session`ï¼šæ•´ä¸ªæµ‹è¯•ä¼šè¯ä¸€æ¬¡ï¼ˆé€šå¸¸ç”¨äº `conftest.py`ï¼‰ã€‚

```python
@pytest.fixture(scope="module")
def shared_resource():
    return "Expensive Resource"
```

## ğŸ“ conftest.py

å¦‚æœä½ å¸Œæœ› Fixture åœ¨å¤šä¸ªæµ‹è¯•æ–‡ä»¶ä¸­å…±äº«ï¼Œåªéœ€å°†å…¶å®šä¹‰åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„ `conftest.py` æ–‡ä»¶ä¸­ã€‚Pytest ä¼šè‡ªåŠ¨å‘ç°å®ƒï¼Œæ— éœ€æ‰‹åŠ¨å¯¼å…¥ã€‚

## ğŸ“š æ€»ç»“

*   Fixture å®ç°äº†æµ‹è¯•çš„ Setup/Teardownã€‚
*   ä½¿ç”¨ `yield` åˆ†ç¦»å‡†å¤‡å’Œæ¸…ç†ä»£ç ã€‚
*   ä½¿ç”¨ `scope` æ§åˆ¶èµ„æºå…±äº«èŒƒå›´ã€‚
*   `conftest.py` æ˜¯å­˜æ”¾å…¨å±€ Fixture çš„åœ°æ–¹ã€‚

ä¸‹ä¸€ç« ï¼Œæˆ‘ä»¬å°†å­¦ä¹ å¦‚ä½•è¿›è¡Œ**å‚æ•°åŒ–æµ‹è¯•**ã€‚
