# Pytest æ•™ç¨‹ - 05. æ ‡è®°ä¸é…ç½®

> **é€‚åˆäººç¾¤**ï¼šè¿›é˜¶å¼€å‘è€…
> **å‰ç½®çŸ¥è¯†**ï¼šå‘½ä»¤è¡ŒåŸºç¡€
> **é¢„è®¡æ—¶é—´**ï¼š15 åˆ†é’Ÿ

## ğŸ·ï¸ ä½¿ç”¨ Mark æ ‡è®°

Pytest å…è®¸ä½ ç»™æµ‹è¯•å‡½æ•°æ‰“æ ‡ç­¾ï¼Œä»¥ä¾¿æŒ‰éœ€è¿è¡Œæˆ–ç‰¹æ®Šå¤„ç†ã€‚

```python
import pytest

@pytest.mark.slow
def test_heavy_computation():
    # æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ
    pass

@pytest.mark.web
def test_api_call():
    pass
```

è¿è¡ŒæŒ‡å®šæ ‡è®°çš„æµ‹è¯•ï¼š

```bash
pytest -m slow
pytest -m "not slow"
```

### ç­›é€‰æµç¨‹

```mermaid
graph LR
    Files[æ‰€æœ‰æµ‹è¯•] -- æ”¶é›† --> All[æµ‹è¯•é›†åˆ]
    All -- "-m slow" --> Filter{åŒ¹é…æ ‡è®°?}
    Filter -- Yes --> Run[æ‰§è¡Œ]
    Filter -- No --> Skip[è·³è¿‡]
```

## â­ï¸ è·³è¿‡ä¸é¢„æœŸå¤±è´¥

*   **Skip**: ç›´æ¥è·³è¿‡ä¸æ‰§è¡Œã€‚
    ```python
    @pytest.mark.skip(reason="åŠŸèƒ½æœªå®Œæˆ")
    def test_feature_x(): ...
    
    @pytest.mark.skipif(sys.platform == "win32", reason="ä¸åœ¨ Windows è¿è¡Œ")
    def test_linux_only(): ...
    ```

*   **Xfail**: é¢„æœŸä¼šå¤±è´¥ï¼ˆå¦‚æœå®ƒé€šè¿‡äº†ï¼Œåè€Œæ˜¯ XPASSï¼‰ã€‚
    ```python
    @pytest.mark.xfail
    def test_bug_123():
        # å·²çŸ¥çš„ Bugï¼Œç­‰å¾…ä¿®å¤
        assert 1 == 2
    ```

## âš™ï¸ é…ç½®æ–‡ä»¶ pytest.ini

ä¸ºäº†é¿å…æ¯æ¬¡éƒ½è¾“å…¥é•¿å‘½ä»¤ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `pytest.ini` é…ç½®æ–‡ä»¶ã€‚

```ini
[pytest]
# é»˜è®¤å‘½ä»¤è¡Œå‚æ•°
addopts = -v --html=report.html

# æ³¨å†Œè‡ªå®šä¹‰æ ‡è®°ï¼Œé˜²æ­¢è­¦å‘Š
markers =
    slow: æ ‡è®°è€—æ—¶æµ‹è¯•
    web: æ ‡è®° Web é›†æˆæµ‹è¯•

# æŒ‡å®šæµ‹è¯•ç›®å½•
testpaths = tests
```

## ğŸ“š æ€»ç»“

*   ä½¿ç”¨ `-m` è¿è¡Œç‰¹å®šæ ‡è®°çš„æµ‹è¯•ã€‚
*   `skip` å’Œ `xfail` å¤„ç†ç‰¹æ®Šæƒ…å†µã€‚
*   `pytest.ini` ç”¨äºæŒä¹…åŒ–é…ç½®ã€‚

ä¸‹ä¸€ç« ï¼Œæˆ‘ä»¬å°†ç»“åˆ **FastAPI** è¿›è¡Œå®æˆ˜æµ‹è¯•ã€‚
